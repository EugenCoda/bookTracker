extends layout

block content
  h1= title
  
  table.booklist
    thead
      tr
        th Title 
        th Author 
        th Avg. Rating
        if user
          th My Status
    tbody
      - book_list.sort(function(a, b) {let textA = a.title.toUpperCase(); let textB = b.title.toUpperCase(); return (textA < textB) ? -1 : (textA > textB) ? 1 : 0;});
      each book in book_list
        tr
          td
            a(href=book.url) #{book.title} 
          td 
            a(href=book.author.url) #{book.author.name} 
          - let ratingCount = 0
          - let ratingSum = 0
          each val, i in booklist_count
            each value, j in booklist_count[i].personal_list
              - if (booklist_count[i].personal_list[j].book.equals(book._id))
                - if (booklist_count[i].personal_list[j].rating)
                  - ratingCount++
                  - ratingSum=ratingSum+booklist_count[i].personal_list[j].rating
              - else 
                return
          if ratingCount == 0
            td N/A
          else
            td #{(ratingSum/ratingCount).toFixed(2)}
          if user
            - let bookAdded = false
            each val, index in personal_list
              - if (personal_list[index].book.title == book.title)
                td #{personal_list[index].status} | 
                  a(href=book.booklisturl+'/edit') Edit | 
                  a(href=book.booklisturl+'/remove') Remove 
                - bookAdded = true
              - else 
                return
            if !bookAdded
              td 
                a(href=book.booklisturl+'/addtolist') Add to list
      else
        p There are no books.